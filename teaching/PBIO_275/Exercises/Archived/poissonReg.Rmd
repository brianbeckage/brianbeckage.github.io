---
title: "R Notebook"
output: html_notebook
---

likPois<-function(lambda,seedlingCounts){
  -sum(dpois(seedlingCounts,lambda,log=TRUE))
}
 

lambda<-c(1.5) # Initial parameter values 
outPois<-optim(par=lambda,fn=likPois,method="L-BFGS-B",lower=c(0.0001),upper=c(10),seedlingCounts=gap)
outPois$par 


```{r}

parVec<-c(0.5) # Initial parameter values 
outNull<-optim(par=parVec,fn=nllPoi,method="L-BFGS-B",lower=c(-Inf),upper=c(Inf),sdlgs=seedlings,lght=light)
outNull$par # 2.572612
outNull$val # nllik= 48.73138
myAIC<-2*1 + 2*outNull$val # 99.46276
myAIC

```



pVect<-seq(from=0,to=1,length=100)
logLik<-sapply(pVect , likBin,n=10,k=headVect)
plot(lambdaVect,-logLik,type="l")

BernLike<-function(p,k){
  y2<-vector()
  j<-0
  for(i in p){
    j<-j+1
    y2[j]<-MylikeBern(i,k)
  }
  return(y2)
}

gTypes<-unique(allData$geno)
gTypesMean1<-sapply(gTypes, (function(gT){mean(subset(allData,genotrt==1 & dist=='U' & geno==gT)$total,na.rm=TRUE)})

nllBinom<-function(pSurv,nPlanted,nSurvive){
  nllik<- -(sum( (dbinom(x=nSurvive, size=nPlanted, prob=pSurv,log=TRUE)) ,na.rm=T))
  cat("nllik= ",nllik,sep=" ",fill=T);cat(" ",sep=" ",fill=T)
  return(nllik)
}


## EXERCISE 4
Calculate the likelihood ratio for the Hypothesis A: Seedling germination probability is 1/2 vs
Hypothesis B: Seedling germination probability is 3/4 for the sample sizes in Exercise 3.

Solution: Likelihood at mle 0.75 = 0.421875

```{r}
dbinom(x=3,size=4,prob=0.5)/dbinom(x=3,size=4,prob=0.75)
dbinom(x=300,size=400,prob=0.5)/dbinom(x=300,size=400,prob=0.75)
```


## Exercise 5

A ecologist surveys 10 1m^2 quadrats and finds the following number of seedlings:
   c(3, 2, 1, 1, 4, 2, 2, 3, 6, 1, 3, 5, 0, 1, 3, 0, 1, 2, 4, 3)
The ecologist believes that the number of seedlings follows Poisson distribution.  What is
the mean of the Poisson?  Show (plot) the likelihood function for the mean.

Another ecologist has a single 20m^2 plot and observes 47 seedlings and 
wants to estimate the mean number of seedlngs per m^2.
What does their likelihood function look like? 
Compare the two likelihoods--how similar are they?



#### EXERCISE 6 Poisson regression

Likelihood function

```{r}

nllPoi<-function(parVec,sdlgs,lght){
  if(length(parVec)>1){
    b0<-parVec[1]
    b1<-parVec[2]
  } else{
    b0<-parVec[1]
    b1<-0
  }
  sdlgPred<-exp(b0+b1*lght)
  nllik<- -sum(dpois(x=sdlgs,lambda=sdlgPred,log=TRUE))
  #nllik<- -(sum( (dbinom(x=nSurvive, size=nPlanted, prob=pSurv,log=TRUE)) ,na.rm=T))
  cat("nllik= ",nllik,sep=" ",fill=T);cat(" ",sep=" ",fill=T)
  return(nllik)
}

```

Simulating data to recover parameters

```{r}
light<-seq(0.1, 0.8,len=10)
# ln(lambda)<-beta0+beta1*light
beta0<-1.0; beta1<-3.0
lam<-exp(beta0+beta1*light)
nSeedlings<-rpois(n=length(lam),lambda=lam)
plot(light,nSeedlings)
light=c(0.10, 0.18, 0.26, 0.33, 0.41, 0.49, 0.57, 0.64, 0.72, 0.80)
seedlings=c(3,  4,  8,  8,  9, 11, 11, 26, 23, 28)

```

Recover parameters: Minimizing our likelihood function
AIC = 2*k - 2*ln(L) where L is the maximized likelihood.
logit(p) = log(p/(1-p))
logit^-1 = exp(p)/(1+exp(p))

```{r}

parVec<-c(0.5,1.0) # Initial parameter values 
outNull<-optim(par=parVec,fn=nllPoi,method="L-BFGS-B",lower=c(-Inf),upper=c(Inf),sdlgs=seedlings,lght=light)
outNull$par # 1.026950 2.969625
outNull$val # nllik= 23.47263
myAIC<-2*2 + 2*outNull$val # 50.94526
myAIC

```

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).
