<html>

<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title>Finding the MLE for a Binomial process</title>
</head>

<body>



<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">#### Finding the MLE for a Binomial process #########################</span>

<span class="hl com">#### Negative log likelihood function</span>
<span class="hl std">nllBinom</span><span class="hl kwb">&lt;-</span><span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">p</span><span class="hl std">,</span><span class="hl kwc">k</span><span class="hl std">,</span><span class="hl kwc">nTrials</span><span class="hl std">){</span>
  <span class="hl std">nll</span><span class="hl kwb">&lt;-</span><span class="hl opt">-</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">dbinom</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=k,</span><span class="hl kwc">size</span><span class="hl std">=nTrials,</span><span class="hl kwc">prob</span><span class="hl std">=p,</span><span class="hl kwc">log</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">),</span><span class="hl kwc">na.rm</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
  <span class="hl kwd">return</span><span class="hl std">(nll)</span>
<span class="hl std">}</span>

<span class="hl com">### Minimizing nll function</span>
<span class="hl std">kObs</span><span class="hl kwb">&lt;-</span><span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwc">n</span><span class="hl std">=</span><span class="hl num">10</span><span class="hl std">,</span><span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">100</span><span class="hl std">,</span><span class="hl kwc">prob</span><span class="hl std">=</span><span class="hl num">0.5</span><span class="hl std">)</span>
<span class="hl std">p</span><span class="hl kwb">&lt;-</span><span class="hl num">0.8</span> <span class="hl com"># Initial parameter values </span>
<span class="hl std">outNull</span><span class="hl kwb">&lt;-</span><span class="hl kwd">optim</span><span class="hl std">(</span><span class="hl kwc">par</span><span class="hl std">=p,</span><span class="hl kwc">fn</span><span class="hl std">=nllBinom,</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;L-BFGS-B&quot;</span><span class="hl std">,</span><span class="hl kwc">lower</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.001</span><span class="hl std">),</span><span class="hl kwc">upper</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.999</span><span class="hl std">),</span><span class="hl kwc">k</span><span class="hl std">=kObs,</span><span class="hl kwc">nTrials</span><span class="hl std">=</span><span class="hl num">100</span><span class="hl std">)</span>
<span class="hl std">outNull</span><span class="hl opt">$</span><span class="hl std">par</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.492
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">outNull</span><span class="hl opt">$</span><span class="hl std">val</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 26.64824
</pre></div>
</div></div>


<p>
Poisson Regression problem. 
<br>
<br>

An ecologist surveys 10 1m^2 quadrats for number of seedlings and records the corresponding light level for each quadrat. The ecologist believes that the number of seedlings follows Poisson distribution.
<br><br>
Question:  What is the relationship between nSeedlings and light level?
<br><br>
Question: What is the Poisson distn? (Look it up in Michael Lavine's book (1.3.2 page 17.)


</p>

Generating some simulated data

<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">light</span><span class="hl kwb">&lt;-</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0.1</span><span class="hl std">,</span> <span class="hl num">0.8</span><span class="hl std">,</span><span class="hl kwc">len</span><span class="hl std">=</span><span class="hl num">100</span><span class="hl std">)</span>
<span class="hl com"># ln(lambda)&lt;-beta0+beta1*light</span>
<span class="hl std">beta0</span><span class="hl kwb">&lt;-</span><span class="hl num">1.0</span><span class="hl std">; beta1</span><span class="hl kwb">&lt;-</span><span class="hl num">3.0</span>
<span class="hl std">myLambda</span><span class="hl kwb">&lt;-</span><span class="hl kwd">exp</span><span class="hl std">(beta0</span><span class="hl opt">+</span><span class="hl std">beta1</span><span class="hl opt">*</span><span class="hl std">light)</span>
<span class="hl std">nSeedlings</span><span class="hl kwb">&lt;-</span><span class="hl kwd">rpois</span><span class="hl std">(</span><span class="hl kwc">n</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(myLambda),</span><span class="hl kwc">lambda</span><span class="hl std">=myLambda)</span>
</pre></div>
</div></div>

<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">plot</span><span class="hl std">(light,nSeedlings)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-3-1.png" title="plot of chunk unnamed-chunk-3" alt="plot of chunk unnamed-chunk-3" class="plot" /></div></div>

<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">### Recovering parameters</span>

<span class="hl std">nllPoi</span><span class="hl kwb">&lt;-</span><span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">parVec</span><span class="hl std">,</span><span class="hl kwc">sdlgs</span><span class="hl std">,</span><span class="hl kwc">lght</span><span class="hl std">){</span>
  <span class="hl kwa">if</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(parVec)</span><span class="hl opt">&gt;</span><span class="hl num">1</span><span class="hl std">){</span>
    <span class="hl std">b0</span><span class="hl kwb">&lt;-</span><span class="hl std">parVec[</span><span class="hl num">1</span><span class="hl std">]</span>
    <span class="hl std">b1</span><span class="hl kwb">&lt;-</span><span class="hl std">parVec[</span><span class="hl num">2</span><span class="hl std">]</span>
  <span class="hl std">}</span> <span class="hl kwa">else</span><span class="hl std">{</span>
    <span class="hl std">b0</span><span class="hl kwb">&lt;-</span><span class="hl std">parVec[</span><span class="hl num">1</span><span class="hl std">]</span>
    <span class="hl std">b1</span><span class="hl kwb">&lt;-</span><span class="hl num">0</span>
  <span class="hl std">}</span>

  <span class="hl std">sdlgPred</span><span class="hl kwb">&lt;-</span><span class="hl kwd">exp</span><span class="hl std">(b0</span><span class="hl opt">+</span><span class="hl std">b1</span><span class="hl opt">*</span><span class="hl std">lght)</span> <span class="hl com"># lmbdaPred</span>

  <span class="hl std">nllik</span><span class="hl kwb">&lt;-</span> <span class="hl opt">-</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">dpois</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=sdlgs,</span><span class="hl kwc">lambda</span><span class="hl std">=sdlgPred,</span><span class="hl kwc">log</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">))</span>
  <span class="hl com">#nllik&lt;- -(sum( (dbinom(x=nSurvive, size=nPlanted, prob=pSurv,log=TRUE)) ,na.rm=T))</span>
  <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;nllik= &quot;</span><span class="hl std">,nllik,</span><span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot; &quot;</span><span class="hl std">,</span><span class="hl kwc">fill</span><span class="hl std">=T);</span><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot; &quot;</span><span class="hl std">,</span><span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot; &quot;</span><span class="hl std">,</span><span class="hl kwc">fill</span><span class="hl std">=T)</span>
  <span class="hl kwd">return</span><span class="hl std">(nllik)</span>
<span class="hl std">}</span>

<span class="hl com">### Minimizing our function using a two parameter model</span>
<span class="hl std">parVec</span><span class="hl kwb">&lt;-</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">1.0</span><span class="hl std">)</span> <span class="hl com"># Initial parameter values </span>
<span class="hl std">outNull</span><span class="hl kwb">&lt;-</span><span class="hl kwd">optim</span><span class="hl std">(</span><span class="hl kwc">par</span><span class="hl std">=parVec,</span><span class="hl kwc">fn</span><span class="hl std">=nllPoi,</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;L-BFGS-B&quot;</span><span class="hl std">,</span><span class="hl kwc">lower</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl num">Inf</span><span class="hl std">),</span><span class="hl kwc">upper</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">Inf</span><span class="hl std">),</span><span class="hl kwc">sdlgs</span><span class="hl std">=nSeedlings,</span><span class="hl kwc">lght</span><span class="hl std">=light)</span>
</pre></div>
<div class="output"><pre class="knitr r">## nllik=  1324.247
##  
## nllik=  1323.25
##  
## nllik=  1325.244
##  
## nllik=  1323.663
##  
## nllik=  1324.831
##  
## nllik=  417.7542
##  
## nllik=  417.2997
##  
## nllik=  418.2094
##  
## nllik=  417.4533
##  
## nllik=  418.0553
##  
## nllik=  516.9741
##  
## nllik=  517.916
##  
## nllik=  516.0343
##  
## nllik=  517.4326
##  
## nllik=  516.5162
##  
## nllik=  293.6746
##  
## nllik=  293.6717
##  
## nllik=  293.6788
##  
## nllik=  293.6163
##  
## nllik=  293.7334
##  
## nllik=  291.337
##  
## nllik=  291.3754
##  
## nllik=  291.2998
##  
## nllik=  291.3028
##  
## nllik=  291.3715
##  
## nllik=  286.2539
##  
## nllik=  286.3328
##  
## nllik=  286.1762
##  
## nllik=  286.2478
##  
## nllik=  286.2604
##  
## nllik=  274.0813
##  
## nllik=  274.2062
##  
## nllik=  273.9577
##  
## nllik=  274.1207
##  
## nllik=  274.0423
##  
## nllik=  263.9959
##  
## nllik=  264.0905
##  
## nllik=  263.9027
##  
## nllik=  264.0382
##  
## nllik=  263.9541
##  
## nllik=  259.591
##  
## nllik=  259.6102
##  
## nllik=  259.5731
##  
## nllik=  259.6006
##  
## nllik=  259.5819
##  
## nllik=  259.4416
##  
## nllik=  259.4435
##  
## nllik=  259.4409
##  
## nllik=  259.4425
##  
## nllik=  259.441
##  
## nllik=  259.4409
##  
## nllik=  259.4415
##  
## nllik=  259.4415
##  
## nllik=  259.4411
##  
## nllik=  259.4411
##  
## nllik=  259.4409
##  
## nllik=  259.4415
##  
## nllik=  259.4415
##  
## nllik=  259.4411
##  
## nllik=  259.4411
##  
## nllik=  259.4409
##  
## nllik=  259.4415
##  
## nllik=  259.4415
##  
## nllik=  259.4411
##  
## nllik=  259.4411
## 
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">outNull</span><span class="hl opt">$</span><span class="hl std">par</span> <span class="hl com"># compared to 1.0 3.0 </span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 1.016568 2.977084
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">outNull</span><span class="hl opt">$</span><span class="hl std">val</span> <span class="hl com"># nllik= 23.47263</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 259.4409
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">myAIC</span><span class="hl kwb">&lt;-</span><span class="hl num">2</span><span class="hl opt">*</span><span class="hl num">2</span> <span class="hl opt">+</span> <span class="hl num">2</span><span class="hl opt">*</span><span class="hl std">outNull</span><span class="hl opt">$</span><span class="hl std">val</span>
<span class="hl std">myAIC</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 522.8817
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">### Minimizing our function using a one parameter model</span>
<span class="hl std">parVec</span><span class="hl kwb">&lt;-</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.5</span><span class="hl std">)</span> <span class="hl com"># Initial parameter values </span>
<span class="hl std">outNull</span><span class="hl kwb">&lt;-</span><span class="hl kwd">optim</span><span class="hl std">(</span><span class="hl kwc">par</span><span class="hl std">=parVec,</span><span class="hl kwc">fn</span><span class="hl std">=nllPoi,</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;L-BFGS-B&quot;</span><span class="hl std">,</span><span class="hl kwc">lower</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl num">Inf</span><span class="hl std">),</span><span class="hl kwc">upper</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">Inf</span><span class="hl std">),</span><span class="hl kwc">sdlgs</span><span class="hl std">=nSeedlings,</span><span class="hl kwc">lght</span><span class="hl std">=light)</span>
</pre></div>
<div class="output"><pre class="knitr r">## nllik=  1938.515
##  
## nllik=  1937.419
##  
## nllik=  1939.611
##  
## nllik=  960.8113
##  
## nllik=  959.9987
##  
## nllik=  961.6244
##  
## nllik=  4792.524
##  
## nllik=  4799.165
##  
## nllik=  4785.891
##  
## nllik=  485.1061
##  
## nllik=  484.9165
##  
## nllik=  485.2967
##  
## nllik=  476.0085
##  
## nllik=  476.1453
##  
## nllik=  475.8731
##  
## nllik=  469.1952
##  
## nllik=  469.1853
##  
## nllik=  469.2065
##  
## nllik=  469.1505
##  
## nllik=  469.1506
##  
## nllik=  469.1516
##  
## nllik=  469.1504
##  
## nllik=  469.151
##  
## nllik=  469.151
##  
## nllik=  469.1504
##  
## nllik=  469.151
##  
## nllik=  469.151
## 
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">outNull</span><span class="hl opt">$</span><span class="hl std">par</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 2.53449
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">outNull</span><span class="hl opt">$</span><span class="hl std">val</span> <span class="hl com"># nllik</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 469.1504
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">myAIC</span><span class="hl kwb">&lt;-</span><span class="hl num">2</span><span class="hl opt">*</span><span class="hl num">1</span> <span class="hl opt">+</span> <span class="hl num">2</span><span class="hl opt">*</span><span class="hl std">outNull</span><span class="hl opt">$</span><span class="hl std">val</span>
<span class="hl std">myAIC</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 940.3007
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">### Which is the better model according to AIC?</span>


<span class="hl com"># AIC = 2*k - 2*ln(L) where L is the maximized likelihood.</span>

<span class="hl com"># for logistic regression</span>
<span class="hl com"># logit(p)=log(p/(1-p))</span>
<span class="hl com"># logit^-1=exp(p)/(1+exp(p))</span>
<span class="hl com"># </span>
<span class="hl com"># p=exp(b0+b1*gap)/(1+exp(b0+b1*gap))</span>
</pre></div>
</div></div>


</body>
</html>
