---
title: "Meeting 9 Solutions"
output: html_notebook
---

9E5.  Which value should Rhat approach, when a chain is sampling the posterior distribution correctly?

_Rhat should approach 1. How close should it get? People disagree, but it is common to judge that any value less than 1.1 indicates convergence. But like all heuristic indicators, Rhat can be fooled._

9H2.  Recall the divorce rate example from Chapter 5. Repeat that analysis, using ulam this time, fitting models m5.1, m5.2, and m5.3. Use compare to compare the models on the basis of WAIC or PSIS. To use WAIC or PSIS with ulam, you need add the argument log_log=TRUE. Explain the model comparison results.

```{r}
library(rethinking)
data(WaffleDivorce)
d <- WaffleDivorce

# standardize variables
d$D <- standardize( d$Divorce )
d$M <- standardize( d$Marriage )
d$A <- standardize( d$MedianAgeMarriage )
d_trim <- list(D=d$D,M=d$M,A=d$A)
```


Here are models m5.1, m5.2, and m5.3, fit using ulam:

```{r}
m5.1_stan <- ulam(
    alist(
        D ~ dnorm(mu, sigma),
        mu <- a + bA * A,
        a ~ dnorm(0,0.2),
        bA ~ dnorm(0,0.5),
        sigma ~ dexp(1)
    ) , data = d_trim,chains=4,log_lik=TRUE )
```

```{r}
m5.2_stan <- ulam(
    alist(
        D ~ dnorm( mu , sigma ) ,
        mu <- a + bM * M ,
        a ~ dnorm( 0 , 0.2 ) ,
        bM ~ dnorm( 0 , 0.5 ) ,
        sigma ~ dexp( 1 )
    ) , data = d_trim, chains=4,log_lik=TRUE )
```


```{r}
m5.3_stan <- ulam(
    alist(
        D ~ dnorm( mu , sigma ) ,
        mu <- a + bM*M + bA*A ,
        a ~ dnorm( 0 , 0.2 ) ,
        bM ~ dnorm( 0 , 0.5 ) ,
        bA ~ dnorm( 0 , 0.5 ) ,
        sigma ~ dexp( 1 )
    ) , data = d_trim, chains=4,log_lik=TRUE)
```
```{r}
precis(m5.1_stan)
precis(m5.2_stan)
precis(m5.3_stan)
```


```{r}
compare(m5.1_stan, m5.2_stan, m5.3_stan, func=PSIS)
```

```{r}
compare(m5.1_stan, m5.2_stan, m5.3_stan, func=WAIC)
```

